// API Configuration
// Automatically detects API URL based on environment
const getApiUrl = () => {
  // Check if we're in development or production
  if (import.meta.env.MODE === 'development') {
    // In development, try to use environment variable or default to current host
    const envApiUrl = import.meta.env.VITE_API_URL;
    if (envApiUrl) {
      return envApiUrl;
    }
    
    // Auto-detect: use same host as frontend, different port
    if (typeof window !== 'undefined') {
      const host = window.location.hostname;
      // If accessing from external IP, use the same IP for API
      if (host !== 'localhost' && host !== '127.0.0.1') {
        return `http://${host}:5000/api`;
      }
    }
    // Default to localhost for local development
    return 'http://localhost:5000/api';
  } else {
    // Production: use environment variable or default to same host
    const envApiUrl = import.meta.env.VITE_API_URL;
    if (envApiUrl) {
      return envApiUrl;
    }
    // In production, assume API is on same host/port or configured via reverse proxy
    return '/api'; // Relative URL works with reverse proxy
  }
};

export const API_BASE_URL = getApiUrl();

// Export individual endpoints
export const API_ENDPOINTS = {
  upload: `${API_BASE_URL}/upload`,
  analysis: (id: string) => `${API_BASE_URL}/analysis/${id}`,
  reportLatest: `${API_BASE_URL}/report/latest`,
  report: (id: string) => `${API_BASE_URL}/report/${id}`,
  health: `${API_BASE_URL}/health`,
};

